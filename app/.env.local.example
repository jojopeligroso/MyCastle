# MyCastle Environment Variables Template
# Copy this file to .env.local and fill in your values

# Supabase Configuration
# Required for authentication (password and magic link)
# Get these from: https://app.supabase.com/project/_/settings/api
NEXT_PUBLIC_SUPABASE_URL=your-project-url.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Magic Link Configuration (in Supabase Dashboard)
# 1. Enable Email provider: Authentication > Providers > Email
# 2. Configure SMTP for email delivery
# 3. Customize email template in Authentication > Email Templates
# 4. Set token expiry (default: 3600 seconds)

# OpenAI Configuration (for lesson planning)
OPENAI_API_KEY=your-openai-api-key

# Database Configuration
# CRITICAL: Our RLS (Row Level Security) system requires session variable support
#
# Supabase offers THREE connection types:
# 1. Direct Connection (port 5432) - Full PostgreSQL, supports session variables ✅
# 2. Session Mode Pooler (port 5432) - Maintains session state, supports session variables ✅
# 3. Transaction Mode Pooler (port 6543) - Fast but NO session state support ❌
#
# Our RLS implementation uses session variables (SET app.user_email, etc.) to enforce
# data isolation. Transaction Mode Pooler (port 6543) will cause navigation failures:
# "Failed query: SET app.user_email = 'user@example.com'"
#
# RECOMMENDED: Use DIRECT_URL with Session Mode Pooler (port 5432)
# Get this from: Supabase Dashboard > Project Settings > Database > Connection Pooling
# Select "Session mode" and copy the connection string
DIRECT_URL=postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres

# Optional: Transaction Mode Pooler (for future JWT-based RLS migration)
# ⚠️ DO NOT use this as your primary connection - it breaks RLS session variables!
# DATABASE_URL=postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres

# Alternative: Direct connection (no pooler)
# Use this if you don't have access to Session Mode Pooler
# Get from: Supabase Dashboard > Project Settings > Database > Connection string
# DATABASE_URL=postgresql://postgres:[PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres

# Next.js Configuration
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Environment
NODE_ENV=development

# Development Auth Bypass (DEVELOPMENT ONLY)
# When set to "true", bypasses authentication and injects a fixed dev user
# CRITICAL: This must NEVER be set to "true" in production/staging/preview
# The application will crash immediately if misconfigured
# Default: not set (bypass disabled)
# DEV_AUTH_BYPASS=true
